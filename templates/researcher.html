<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Responsive layout -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Researcher Dashboard</title>

    <!-- Styles -->
    <link rel="stylesheet" href="/static/styleForUsers.css">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<!-- Navigation bar -->
<nav class="navbar">
    <div class="nav-container">
        <!-- System title -->
        <div class="nav-brand">
            <h2><i class="fas fa-university"></i> Academic Publication System</h2>
        </div>

        <!-- Nav links -->
        <div class="nav-menu">
            <a href="/researcher" class="nav-link active">Dashboard</a>
            <a href="/profile" class="nav-link">Profile</a>

            <!-- User actions -->
            <div class="user-menu">
                <span class="username" id="username" onclick="profile()"></span>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </div>
</nav>

<div class="container">

    <!-- Welcome section -->
    <div class="dashboard-header">
        <h1>Welcome, <span id="researcherName"></span></h1>
        <p>Manage your research publications</p>
    </div>

    <!-- Statistics cards -->
    <div class="stats-grid">

        <div class="stat-card pending">
            <div class="stat-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalCount">0</h3>
                <p>Total Submissions</p>
            </div>
        </div>

        <div class="stat-card approved">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
                <h3 id="approvedCount">0</h3>
                <p>Approved Submissions</p>
            </div>
        </div>

        <div class="stat-card rejected">
            <div class="stat-icon">
                <i class="fas fa-times-circle"></i>
            </div>
            <div class="stat-info">
                <h3 id="rejectedCount">0</h3>
                <p>Rejected Submissions</p>
            </div>
        </div>

    </div>

    <!-- Submit publication form -->
    <div class="content-section submit-card">
        <div class="section-header">
            <h2><i class="fas fa-upload"></i> Submit New Publication</h2>
            <p class="section-subtitle">Upload your research paper and supporting proof</p>
        </div>

        <form action="/researcher" method="POST" enctype="multipart/form-data" class="publication-form">

            <div class="form-row">
                <div class="form-group full">
                    <label>Publication Title</label>
                    <input type="text" name="title_research" placeholder="Enter your publication title..." required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group full">
                    <label>Abstract</label>
                    <textarea name="abstract_research" placeholder="Write a short abstract..." rows="4" required></textarea>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Publication File</label>
                    <input type="file" name="publication_file" required>
                    <small>Upload the main paper (PDF)</small>
                </div>

                <div class="form-group">
                    <label>Proof Document</label>
                    <input type="file" name="proof_file" required>
                    <small>Acceptance letter / supporting proof</small>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="submit-btn">
                    <i class="fas fa-paper-plane"></i>
                    Submit Publication
                </button>
            </div>

        </form>
    </div>

    <!-- Publications table -->
    <div class="content-section">
        <div class="section-header">
            <h2><i class="fas fa-file"></i> My Publications</h2>
        </div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <!-- Filled by JS -->
                <tbody id="researcherPublications"></tbody>
            </table>
        </div>
    </div>

</div>

<!-- Footer -->
<footer class="footer">
    <p>Academic Publication System &copy; 2026</p>
</footer>

<script>
// Fetch logged-in user info
fetch('/user-info')
.then(res => res.json())
.then(data => {
    document.getElementById('researcherName').innerText = data.user_info.name;
    document.getElementById('username').innerText = data.user_info.username;
});

// Load submission statistics
function loadStats() {
    fetch('/researcher/stats')
    .then(res => res.json())
    .then(data => {
        document.getElementById('totalCount').innerText = data.total || 0;
        document.getElementById('approvedCount').innerText = data.approved || 0;
        document.getElementById('rejectedCount').innerText = data.rejected || 0;
    });
}

// Load researcher publications
function loadPublications() {
    fetch('/researcher/allPublications')
    .then(res => res.json())
    .then(rows => {
        const table = document.getElementById('researcherPublications');

        table.innerHTML = rows.map(row => `
            <tr>
                <td>${row.title}</td>
                <td>${row.status}</td>
                <td>${row.publicationDate || ''}</td>
                <td>
                    <button onclick="deletePublication(${row.publicationID})">
                        <i class="fas fa-trash"></i>
                        Delete
                    </button>
                </td>
            </tr>
        `).join('');
    });
}

// Init page data
document.addEventListener('DOMContentLoaded', () => {
    loadStats();
    loadPublications();
});

// Delete publication
function deletePublication(id){
    if(!confirm("Delete this publication permanently?")) return;

    fetch('/researcher/deletePublication/' + id, {
        method: 'DELETE'
    })
    .then(res => res.json())
    .then(data => {
        if(data.success){
            alert("Deleted successfully");
            loadPublications();
            loadStats();
        } else {
            alert("Delete failed");
        }
    })
    .catch(() => alert("Server error"));
}

// Logout user
function logout(){
    window.location.href="/login";
}

// Go to profile
function profile(){
    window.location.href="/profile";
}
</script>

</body>
</html>