<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>

    <!-- Main stylesheet -->
    <link rel="stylesheet" href="/static/styleForUsers.css">

    <!-- Fonts and Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<!-- NAVBAR: Top navigation bar for admin -->
<nav class="navbar">
    <div class="nav-container">
        <div class="nav-brand">
            <h2><i class="fas fa-university"></i> Academic Publication System</h2>
        </div>

        <div class="nav-menu">
            <!-- Dashboard navigation -->
            <a href="/admin" class="nav-link active">Dashboard</a>

            <!-- Link to user management section -->
            <a href="#section2" class="nav-link">Manage Users</a>

            <!-- Logged-in admin info + logout -->
            <div class="user-menu">
                <span class="username" id="username" onclick="profile()"></span>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </div>
</nav>

<div class="container">

    <!-- PAGE HEADER: Greeting + description -->
    <div class="dashboard-header">
        <h1>Welcome, <span id="adminName"></span></h1>
        <p>Manage users and monitor system statistics</p>
    </div>

    <!-- STATS CARDS: Shows system totals -->
    <div class="stats-grid">

        <!-- Total Publications -->
        <div class="stat-card approved">
            <div class="stat-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="stat-info">
                <h3 id="pubCount"></h3>
                <p>Total Publications</p>
            </div>
        </div>

        <!-- Total Students -->
        <div class="stat-card pending">
            <div class="stat-icon">
                <i class="fas fa-user-graduate"></i>
            </div>
            <div class="stat-info">
                <h3 id="studentCount"></h3>
                <p>Total Students</p>
            </div>
        </div>

        <!-- Total Researchers -->
        <div class="stat-card rejected">
            <div class="stat-icon">
                <i class="fas fa-flask"></i>
            </div>
            <div class="stat-info">
                <h3 id="researcherCount"></h3>
                <p>Total Researchers</p>
            </div>
        </div>

        <!-- Total Programme Coordinators -->
        <div class="stat-card changes">
            <div class="stat-icon">
                <i class="fas fa-chalkboard-teacher"></i>
            </div>
            <div class="stat-info">
                <h3 id="coordinatorCount"></h3>
                <p>Total Programme Coordinators</p>
            </div>
        </div>

    </div>

    <!-- USERS MANAGEMENT SECTION -->
    <section id="section2">
        <div class="content-section">

            <!-- Section title -->
            <div class="section-header">
                <h2><i class="fas fa-users"></i> All Users</h2>
            </div>

            <!-- Table displaying all registered users -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Username</th>
                            <th>Role</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="allUsers"></tbody>
                </table>
            </div>
        </div>
    </section>

</div>

<!-- FOOTER -->
<footer class="footer">
    <p>Academic Publication System &copy; 2026</p>
</footer>

<script>
/* Load admin name + username from session */
fetch('/user-info')
.then(res => res.json())
.then(data => {
    document.getElementById('adminName').innerText = data.user_info.name;
    document.getElementById('username').innerText = data.user_info.username;
});

/* Load dashboard statistics */
fetch('/admin/stats')
.then(res => res.json())
.then(data => {
    document.getElementById('pubCount').innerText = data.totalpublications;
    document.getElementById('studentCount').innerText = data.totalStudents;
    document.getElementById('researcherCount').innerText = data.totalResearchers;
    document.getElementById('coordinatorCount').innerText = data.totalCoordinators;
});

/* Load all users into the table */
function loadUsers() {
    fetch('/admin/allUsers')
    .then(res => res.json())
    .then(rows => {
        const table = document.getElementById('allUsers');

        table.innerHTML = rows.map(row => `
            <tr>
                <td>${row.id}</td>
                <td>${row.name}</td>
                <td>${row.username}</td>
                <td>${row.role}</td>
                <td>
                    <button class="delete-btn" onclick="deleteUser(${row.id})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </td>
            </tr>
        `).join('');
    });
}

/* Run when page loads */
document.addEventListener('DOMContentLoaded', loadUsers);

/* Delete user by ID */
function deleteUser(id){
    if(confirm("Delete this user?")){
        fetch('/admin/deleteUser/' + id, {
            method:'DELETE'
        })
        .then(res => res.json())
        .then(() => loadUsers());
    }
}

/* Logout redirect */
function logout(){
    window.location.href="/login";
}

/* Go to profile page */
function profile(){
    window.location.href="/profile";
}
</script>

</body>
</html>
